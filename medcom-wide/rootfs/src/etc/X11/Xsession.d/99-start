if test "x$XDG_CONFIG_HOME" = "x"; then
	XDG_CONFIG_HOME="$HOME/.config"
fi

# backup old session file for later analysis
if test -e /var/log/Xsession.log; then
	rm -f /var/log/Xsession.log.gz
	/bin/gzip /var/log/Xsession.log
fi

eval `dbus-launch --sh-syntax`
# Make the session bus address available for use from a ssh session, etc.
echo "export DBUS_SESSION_BUS_ADDRESS=$DBUS_SESSION_BUS_ADDRESS" > /var/run/dbus-session-bus-address

/usr/lib/at-spi2/at-spi-bus-launcher --launch-immediately >/tmp/spi.log 2>&1 &

if test "x$WINDOW_MANAGER" != "x"; then
	$WINDOW_MANAGER &
fi
if test "x$KEYBOARD" != "x"; then
	$KEYBOARD &
fi
exec $STARTUP 2>&1 | /usr/bin/logger -t Xsession -id
