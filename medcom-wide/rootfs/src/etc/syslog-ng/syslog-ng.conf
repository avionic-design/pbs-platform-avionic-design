@version: 3.3
# For a description of syslog-ng configuration file directives, please read
# the syslog-ng Administrator's guide at:
#
# http://www.balabit.com/dl/html/syslog-ng-admin-guide_en.html/bk01-toc.html
#

##########################################################
# OPTIONS
#
options {
	create_dirs(yes);
	use_dns(no);

	# disable the chained hostname format in logs (default is enabled)
	chain_hostnames(0);

	# enable or disable directory creation for destination files
	create_dirs(yes);

	# default owner, group, and permissions for log files (defaults are 0, 0, 0600)
	owner(root);
	group(root);
	perm(0640);

	# default owner, group, and permissions for created directories (defaults are 0, 0, 0700)
	dir_owner(root);
	dir_group(root);
	dir_perm(0740);

	# the time to wait before a died connection is re-established (default is 60)
	time_reopen(10);

	# the time to wait before an idle destination file is closed (default is 60)
	time_reap(360);

	# default no
	use_fqdn(no);

	keep_hostname(yes);

	# disable stats
	stats_freq(0);
};


##########################################################
# SOURCES
#
source local_src {
	# message generated by syslog-ng
	internal();

	# standard Linux log source (this is the default place for the syslog() function to send logs to)
	unix-stream("/dev/log");

	# messages from the kernel
	file("/proc/kmsg" program_override("kernel: "));
};

# source s_syslog {
#	syslog(ip(127.0.0.1) port(1999) transport("tcp"));
#};

# source s_pipe {
#	pipe("/dev/pipe" pad_size(2048));
#};



##########################################################
# DESTINATIONS
#
destination d_file {
	file("/var/log/everything.log" template("$HOUR:$MIN:$SEC [$LEVEL] [$FACILITY] [$PROGRAM] $MSG\n") template_escape(no));
};

destination d_authlog { file("/var/log/auth.log"); };
destination d_cron { file("/var/log/cron.log"); };
destination d_daemon { file("/var/log/daemon.log"); };
destination d_kern { file("/var/log/kern.log"); };
destination d_mail { file("/var/log/mail.log"); };
destination d_debug { file("/var/log/debug"); };
destination d_messages { file("/var/log/messages"); };
destination d_firewall { file("/var/log/firewall.log"); };

destination d_console { usertty("root"); };
destination d_console_all { file("/dev/tty8"); };

destination d_remotecontrol { file("/var/log/remote-control.log"); };
destination d_nodm { file("/var/log/nodm.log"); };
destination d_sshd { file("/var/log/ssh.log"); };



##########################################################
# FILTERS
#
filter f_auth { facility(auth); };
filter f_authpriv { facility(auth, authpriv); };
filter f_syslog { program(syslog-ng); };
filter f_cron { facility(cron); };
filter f_daemon { facility(daemon); };
filter f_kernel { facility(kern) and not filter(f_iptables); };
filter f_debug { not facility(auth, authpriv, news, mail); };
filter f_messages {
	level(info..warn) and not filter(f_cron) and not filter(f_debug) and
		not filter(f_syslog) and not filter(f_iptables) and
		not filter(f_remotecontrol_all) and not filter(f_nodm);
};

filter f_iptables { match("IN=" value("MESSAGE")) and match("OUT=" value("MESSAGE")); };
filter f_everything { level(debug..emerg); };

filter f_sshd { match('^sshd\[[0-9]+\]:'); };
filter f_nodm { match('^nodm\[[0-9]+\]:'); };
filter f_remotecontrol { match('^remote-control\[[0-9]+\]:'); };
filter f_remotecontrol_stable { level(warn..emerg) and filter(f_remotecontrol); };



##########################################################
# LOG
#
#log { source(local_src); destination(d_file); };
#log { source(local_src); filter(f_daemon); destination(d_daemon); };
#log { source(local_src); filter(f_debug); destination(d_debug); };
#log { source(local_src); filter(f_iptables); destination(d_firewall); };

log { source(local_src); filter(f_authpriv); destination(d_authlog); };
log { source(local_src); filter(f_kernel); destination(d_kern); };
log { source(local_src); filter(f_cron); destination(d_cron); };
log { source(local_src); filter(f_messages); destination(d_messages); };

log { source(local_src); filter(f_remotecontrol); destination(d_remotecontrol); };
log { source(local_src); filter(f_nodm); destination(d_nodm); };
log { source(local_src); filter(f_sshd); destination(d_sshd); };

#default log
log { source(local_src); destination(d_console_all); };
